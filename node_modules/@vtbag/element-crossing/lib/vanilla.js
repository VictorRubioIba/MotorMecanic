"use strict";(()=>{var d=!1,k="/svg",l=top.__vtbag?.elementCrossing;v();function v(){if(l?.fun){if(self===top)return;top.document.title=self.document.title,top.history.replaceState(self.history.state,"",self.location.href),self.crossingStorage=l.fun}document.addEventListener("astro:after-preparation",u),document.addEventListener("astro:after-swap",m),self.addEventListener("onpageswap"in self?"pageswap":"pagehide",u),self.addEventListener("onpagereveal"in self?"pagereveal":"DOMContentLoaded",m)}function u(){self.crossingStorage?self.crossingStorage.setItem("@vtbag/element-crossing",p()):top.sessionStorage.setItem("@vtbag/element-crossing",JSON.stringify(p()))}function m(){let t,o;(o=self.crossingStorage)?t=o.getItem("@vtbag/element-crossing")??[]:(o=top.sessionStorage,t=JSON.parse(o.getItem("@vtbag/element-crossing")??"[]")),top.sessionStorage.removeItem("@vtbag/element-crossing"),self.crossingStorage?.removeItem("@vtbag/element-crossing"),performance?.navigation?.type!==1&&"navigation"in self&&self.navigation?.navigationType!=="reload"&&y(t)}function p(){let t=new Set,o=[];return self.document.querySelectorAll("[data-vtbag-x]").forEach(s=>{let e=b(s);e&&(t.has(e.id)&&console.error("[crossing]","non unique id",e.id),o.push(e),t.add(e.id))}),d&&console.log("[crossing]","retrieve",o),o}function b(t){function o(i,a){let[n,r]=i.split(":",2);if(!n)return console.error("[crossing]","syntax error:",i,"is not recognized as a valid specification in",a),["<none>",r];if(r===void 0)switch(r=n.slice(1),n[0]){case"#":n="id";break;case".":n="class";break;case"@":n="prop";break;case"-":n="style";break;case"~":n="anim";break;case"&":if(n="elem",l?.fun)break;default:console.error("[crossing]","syntax error:",i,"is not recognized as a valid specification in",a)}return[n,r]}let s=t.id,e=[];if(t.getAttribute("data-vtbag-x")?.trim().split(/\s+/).forEach(i=>{let[a,n]=o(i,t);switch(a){case"id":s=n;break;case"class":e.push({kind:a,key:n,value:t.classList.contains(n)?"true":"false"});break;case"style":e.push({kind:a,key:n,value:""+(t.style[n]??"")});break;case"bool":case"num":case"prop":let r=t[n],g=typeof r;e.push({kind:g==="boolean"?"bool":g==="number"?"num":"prop",key:n,value:""+r});break;case"anim":if(n===k){if(!(t instanceof SVGSVGElement)){console.error("[crossing]",`retrieval: element is not an SVG element, but "${n}" was used for its key`,t);break}let c=t.getCurrentTime();c>0&&e.push({kind:a,key:n,value:c.toString()})}else{let c=t.getAnimations().filter(f=>f instanceof CSSAnimation&&f.animationName===n);c.length>1&&console.error("[crossing]",`retrieval: animation name ${n} is not unique for`,t),c.length>0&&e.push({kind:a,key:n,value:""+(c[0].currentTime??0)})}break;case"elem":top?.__vtbag?.elementCrossing?.fun&&(self.crossingStorage.setItem(n,t),e.push({kind:a,key:n}));break;default:console.error("[crossing]","unknown kind",a);break}}),!s)console.error("[crossing]","missing id in",t);else return{id:s,timestamp:new Date().getTime(),specs:e}}function y(t){d&&console.log("[crossing]","restore",t),t.forEach(o=>{let s=document.querySelector("#"+o.id+",[data-vtbag-x*='#"+o.id+"'],[data-vtbag-x*='id:"+o.id+"']");s&&o.specs.forEach(e=>{switch(e.kind){case"class":s.classList[e.value==="true"?"add":"remove"](e.key);break;case"style":e.key==="length"||e.key==="parentRule"?console.error("[crossing]","Cannot assign to read-only property",e.key,"in",o.id):s.style.setProperty(e.key,e.value??"");break;case"prop":s[e.key]=e.value;break;case"bool":s[e.key]=e.value==="true";break;case"num":s[e.key]=parseFloat(e.value??"0");break;case"anim":if(e.key===k){if(!(s instanceof SVGSVGElement)){console.error("[crossing]",`restore: element for key ${e.key} is not an SVG element`,s);break}s.setCurrentTime(parseFloat(e.value??"0")+(new Date().getTime()-o.timestamp)/1e3)}else{let a=s.getAnimations().filter(n=>n instanceof CSSAnimation&&n.animationName===e.key);a.length>1&&console.warn("[crossing]",`restore: animation name ${e.key} is not unique for`,s),a.forEach(n=>n.currentTime=~~(e.value??"0")+(new Date().getTime()-o.timestamp))}break;case"elem":if(top?.__vtbag?.elementCrossing?.fun){let a=self.crossingStorage.getItem(e.key);a&&(s.replaceWith(a),s=a)}break;default:console.error("[crossing]","unknown kind",e.kind);break}})})}})();
